# 视频流预测

## 架构

`SlowFast`的视频流处理实现架构如下：

1. 可分为`3`个组件：
    1. 管理器（`Manager`）：执行输入和输出操作；
        1. 有两种输入：从摄像头输入和从视频文件中输入；
        2. 有两种输出：写入到文件和在屏幕显示。
    2. 预测器（`Predictor`）：对输入数据进行预测；
    3. 绘制器（`Visualizor`）：在视频数据中绘制预测结果。
2. 整体实现流程如下：
    1. 从管理器中获取输入数据；
    2. 输入到预测器得到预测结果；
    3. 输入到绘制器得到绘制结果；
    4. 输入回管理器进行数据保存。

整个流程遵循读取一个视频片段，处理完成后写入一个视频片段的一对一执行顺序

在SlowFast中同时实现了检测和分类任务，当前仅关注于分类任务

## 管理器

1. 输入数据执行流程如下：
    1. 判断输入源是摄像头还是视频文件，创建输入对象；
    2. 获取相关属性（长、宽、帧率、缓存帧数、视频片段长度等等）；
    3. 如果保存到文件，则创建输出对象，其属性（长、宽、帧率）和输入源一致；
    4. 读取视频流，获取指定长度的视频片段，保存缓存数据并返回。
2. 输出数据执行流程如下：
    1. 判断输出方式：如果为显示，则按指定帧率显示；否则，执行写入文件操作。

## 预测器

* 同步预测器：
    1. 创建预测器，初始化预测环境；
    2. 对输入的视频片段进行预测，完成后调用绘制器进行绘制；
    3. 从绘制器中获取绘制完成的视频片段并返回。
* 多进程预测器：
    1. 根据GPU个数创建预测器；
    2. 将输入的视频片段加入到预测队列`predict_task_queue`，在各个进程中完成预测后输入到绘制队列`visualize_task_queue`；
    3. 从绘制器中获取绘制完成的视频片段并返回。

## 绘制器

* 创建多进程进行图像绘制：
    * 通过队列`task_queue`传入待绘制视频片段；
    * 通过队列`result_queue`获取绘制得到的视频片段。